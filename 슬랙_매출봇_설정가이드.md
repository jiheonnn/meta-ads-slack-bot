# 슬랙 매출봇 설정 가이드

## 1. 슬랙 웹훅 URL 생성

1. 슬랙 워크스페이스의 앱 관리로 이동
2. "Incoming Webhooks" 앱 추가
3. 메시지를 받을 채널 선택
4. 웹훅 URL 복사

## 2. 코드 설정

`daily_sales_slack.py` 파일에서 다음 부분을 수정:

```python
SLACK_WEBHOOK_URL = "https://hooks.slack.com/services/YOUR/WEBHOOK/URL"
```

## 3. 의존성 설치

```bash
pip install -r requirements.txt
```

## 4. 실행 방법

### 테스트 실행
```bash
python daily_sales_slack.py
```

### 백그라운드 실행 (Linux/Mac)
```bash
nohup python daily_sales_slack.py &
```

### 서비스로 등록 (시스템 부팅시 자동 시작)

#### macOS (launchd)
`~/Library/LaunchAgents/com.imweb.salesbot.plist` 파일 생성:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <key>Label</key>
    <string>com.imweb.salesbot</string>
    <key>ProgramArguments</key>
    <array>
        <string>/usr/bin/python3</string>
        <string>/Users/jiheonbaek/dev/imweb/daily_sales_slack.py</string>
    </array>
    <key>WorkingDirectory</key>
    <string>/Users/jiheonbaek/dev/imweb</string>
    <key>RunAtLoad</key>
    <true/>
    <key>KeepAlive</key>
    <true/>
</dict>
</plist>
```

서비스 등록:
```bash
launchctl load ~/Library/LaunchAgents/com.imweb.salesbot.plist
```

#### Linux (systemd)
`/etc/systemd/system/imweb-salesbot.service` 파일 생성:

```ini
[Unit]
Description=Imweb Daily Sales Slack Bot
After=network.target

[Service]
Type=simple
User=your_username
WorkingDirectory=/path/to/imweb
ExecStart=/usr/bin/python3 /path/to/imweb/daily_sales_slack.py
Restart=always

[Install]
WantedBy=multi-user.target
```

서비스 등록:
```bash
sudo systemctl enable imweb-salesbot.service
sudo systemctl start imweb-salesbot.service
```

## 5. 로그 확인

프로그램 실행 시 콘솔에 다음과 같은 메시지가 출력됩니다:
- `🤖 매출봇이 시작되었습니다!`
- `⏰ 매일 오후 11시 59분에 매출 리포트를 전송합니다.`
- `✅ 슬랙 전송 성공: [시간]`

## 6. 슬랙 메시지 예시

```
📊 2024-01-15 일일 매출 리포트

💰 총 매출: 1,250,000원
📦 총 주문: 25건

📈 상품별 매출:
   • 다이어트의 정석: 750,000원 (15개)
   • 벌크업의 정석: 500,000원 (10개)

📊 평균 주문 금액: 50,000원
```

## 문제 해결

### 토큰 만료 시
- `oauth_token_manager.py`를 실행하여 토큰 갱신
- 또는 `get_first_token.py`로 새 토큰 생성

### 슬랙 전송 실패 시
- 웹훅 URL 확인
- 네트워크 연결 상태 확인
- 슬랙 워크스페이스 권한 확인